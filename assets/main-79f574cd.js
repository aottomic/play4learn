class _{constructor(t){this.properties=t??[]}get(t){const o=this.properties.filter(n=>n.name===t).map(n=>n.value);if(o.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(o.length!==0)return o[0]}getString(t){return this.getByType(t,"string")}getNumber(t){return this.getByType(t,"number")}getBoolean(t){return this.getByType(t,"boolean")}getByType(t,o){const n=this.get(t);if(n!==void 0){if(o!=="json"&&typeof n!==o)throw new Error('Expected property "'+t+'" to have type "'+o+'"');return n}}mustGetString(t){return this.mustGetByType(t,"string")}mustGetNumber(t){return this.mustGetByType(t,"number")}mustGetBoolean(t){return this.mustGetByType(t,"boolean")}mustGetByType(t,o){const n=this.get(t);if(n===void 0)throw new Error('Property "'+t+'" is missing');if(o!=="json"&&typeof n!==o)throw new Error('Expected property "'+t+'" to have type "'+o+'"');return n}getType(t){const o=this.properties.filter(n=>n.name===t).map(n=>n.type);if(o.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(o.length!==0)return o[0]}}const Me="https://unpkg.com/@workadventure/scripting-api-extra@1.7.4/dist";class Ke{constructor(t){this.name=t.name,this.x=t.x,this.y=t.y,this.properties=new _(t.properties)}get isReadable(){const t=this.properties.getString("readableBy");return t?WA.player.tags.includes(t):!0}get isWritable(){const t=this.properties.getString("writableBy");return t?WA.player.tags.includes(t):!0}}function ue(e){const t=e?"#"+e.join():"";WA.nav.openCoWebSite(Me+"/configuration.html"+t,!0)}async function $e(e,t){const o=await WA.room.getTiledMap(),n=new Map;return Ie(o.layers,n,e,t),n}function Ie(e,t,o,n){for(const r of e)if(r.type==="objectgroup"){for(const s of r.objects)if(s.type==="variable"||s.class==="variable"){if(o&&r.name!==o||n&&!n.includes(s.name))continue;t.set(s.name,new Ke(s))}}else r.type==="group"&&Ie(r.layers,t,o,n)}let Y;async function G(){return Y===void 0&&(Y=Ye()),Y}async function Ye(){return qe(await WA.room.getTiledMap())}function qe(e){const t=new Map;return Ne(e.layers,"",t),t}function Ne(e,t,o){for(const n of e)n.type==="group"?Ne(n.layers,t+n.name+"/",o):(n.name=t+n.name,o.set(n.name,n))}async function ke(){const e=await G(),t=[];for(const o of e.values())if(o.type==="objectgroup")for(const n of o.objects)(n.type==="area"||n.class==="area")&&t.push(n);return t}function Je(e){let t=1/0,o=1/0,n=0,r=0;const s=e.data;if(typeof s=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let a=0;a<e.height;a++)for(let i=0;i<e.width;i++)s[i+a*e.width]!==0&&(t=Math.min(t,i),r=Math.max(r,i),o=Math.min(o,a),n=Math.max(n,a));return{top:o,left:t,right:r+1,bottom:n+1}}function Ge(e){let t=1/0,o=1/0,n=0,r=0;for(const s of e){const a=Je(s);a.left<t&&(t=a.left),a.top<o&&(o=a.top),a.right>r&&(r=a.right),a.bottom>n&&(n=a.bottom)}return{top:o,left:t,right:r,bottom:n}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var Xe=Object.prototype.toString,O=Array.isArray||function(t){return Xe.call(t)==="[object Array]"};function ae(e){return typeof e=="function"}function ze(e){return O(e)?"array":typeof e}function q(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function fe(e,t){return e!=null&&typeof e=="object"&&t in e}function Qe(e,t){return e!=null&&typeof e!="object"&&e.hasOwnProperty&&e.hasOwnProperty(t)}var Ze=RegExp.prototype.test;function et(e,t){return Ze.call(e,t)}var tt=/\S/;function ot(e){return!et(tt,e)}var nt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function rt(e){return String(e).replace(/[&<>"'`=\/]/g,function(o){return nt[o]})}var st=/\s*/,at=/\s+/,de=/\s*=/,it=/\s*\}/,ct=/#|\^|\/|>|\{|&|=|!/;function lt(e,t){if(!e)return[];var o=!1,n=[],r=[],s=[],a=!1,i=!1,c="",l=0;function d(){if(a&&!i)for(;s.length;)delete r[s.pop()];else s=[];a=!1,i=!1}var g,u,v;function E(R){if(typeof R=="string"&&(R=R.split(at,2)),!O(R)||R.length!==2)throw new Error("Invalid tags: "+R);g=new RegExp(q(R[0])+"\\s*"),u=new RegExp("\\s*"+q(R[1])),v=new RegExp("\\s*"+q("}"+R[1]))}E(t||y.tags);for(var p=new B(e),w,f,b,P,D,C;!p.eos();){if(w=p.pos,b=p.scanUntil(g),b)for(var $=0,Ve=b.length;$<Ve;++$)P=b.charAt($),ot(P)?(s.push(r.length),c+=P):(i=!0,o=!0,c+=" "),r.push(["text",P,w,w+1]),w+=1,P===`
`&&(d(),c="",l=0,o=!1);if(!p.scan(g))break;if(a=!0,f=p.scan(ct)||"name",p.scan(st),f==="="?(b=p.scanUntil(de),p.scan(de),p.scanUntil(u)):f==="{"?(b=p.scanUntil(v),p.scan(it),p.scanUntil(u),f="&"):b=p.scanUntil(u),!p.scan(u))throw new Error("Unclosed tag at "+p.pos);if(f==">"?D=[f,b,w,p.pos,c,l,o]:D=[f,b,w,p.pos],l++,r.push(D),f==="#"||f==="^")n.push(D);else if(f==="/"){if(C=n.pop(),!C)throw new Error('Unopened section "'+b+'" at '+w);if(C[1]!==b)throw new Error('Unclosed section "'+C[1]+'" at '+w)}else f==="name"||f==="{"||f==="&"?i=!0:f==="="&&E(b)}if(d(),C=n.pop(),C)throw new Error('Unclosed section "'+C[1]+'" at '+p.pos);return ft(ut(r))}function ut(e){for(var t=[],o,n,r=0,s=e.length;r<s;++r)o=e[r],o&&(o[0]==="text"&&n&&n[0]==="text"?(n[1]+=o[1],n[3]=o[3]):(t.push(o),n=o));return t}function ft(e){for(var t=[],o=t,n=[],r,s,a=0,i=e.length;a<i;++a)switch(r=e[a],r[0]){case"#":case"^":o.push(r),n.push(r),o=r[4]=[];break;case"/":s=n.pop(),s[5]=r[2],o=n.length>0?n[n.length-1][4]:t;break;default:o.push(r)}return t}function B(e){this.string=e,this.tail=e,this.pos=0}B.prototype.eos=function(){return this.tail===""};B.prototype.scan=function(t){var o=this.tail.match(t);if(!o||o.index!==0)return"";var n=o[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n};B.prototype.scanUntil=function(t){var o=this.tail.search(t),n;switch(o){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,o),this.tail=this.tail.substring(o)}return this.pos+=n.length,n};function T(e,t){this.view=e,this.cache={".":this.view},this.parent=t}T.prototype.push=function(t){return new T(t,this)};T.prototype.lookup=function(t){var o=this.cache,n;if(o.hasOwnProperty(t))n=o[t];else{for(var r=this,s,a,i,c=!1;r;){if(t.indexOf(".")>0)for(s=r.view,a=t.split("."),i=0;s!=null&&i<a.length;)i===a.length-1&&(c=fe(s,a[i])||Qe(s,a[i])),s=s[a[i++]];else s=r.view[t],c=fe(r.view,t);if(c){n=s;break}r=r.parent}o[t]=n}return ae(n)&&(n=n.call(this.view)),n};function m(){this.templateCache={_cache:{},set:function(t,o){this._cache[t]=o},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}m.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};m.prototype.parse=function(t,o){var n=this.templateCache,r=t+":"+(o||y.tags).join(":"),s=typeof n<"u",a=s?n.get(r):void 0;return a==null&&(a=lt(t,o),s&&n.set(r,a)),a};m.prototype.render=function(t,o,n,r){var s=this.getConfigTags(r),a=this.parse(t,s),i=o instanceof T?o:new T(o,void 0);return this.renderTokens(a,i,n,t,r)};m.prototype.renderTokens=function(t,o,n,r,s){for(var a="",i,c,l,d=0,g=t.length;d<g;++d)l=void 0,i=t[d],c=i[0],c==="#"?l=this.renderSection(i,o,n,r,s):c==="^"?l=this.renderInverted(i,o,n,r,s):c===">"?l=this.renderPartial(i,o,n,s):c==="&"?l=this.unescapedValue(i,o):c==="name"?l=this.escapedValue(i,o,s):c==="text"&&(l=this.rawValue(i)),l!==void 0&&(a+=l);return a};m.prototype.renderSection=function(t,o,n,r,s){var a=this,i="",c=o.lookup(t[1]);function l(u){return a.render(u,o,n,s)}if(c){if(O(c))for(var d=0,g=c.length;d<g;++d)i+=this.renderTokens(t[4],o.push(c[d]),n,r,s);else if(typeof c=="object"||typeof c=="string"||typeof c=="number")i+=this.renderTokens(t[4],o.push(c),n,r,s);else if(ae(c)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");c=c.call(o.view,r.slice(t[3],t[5]),l),c!=null&&(i+=c)}else i+=this.renderTokens(t[4],o,n,r,s);return i}};m.prototype.renderInverted=function(t,o,n,r,s){var a=o.lookup(t[1]);if(!a||O(a)&&a.length===0)return this.renderTokens(t[4],o,n,r,s)};m.prototype.indentPartial=function(t,o,n){for(var r=o.replace(/[^ \t]/g,""),s=t.split(`
`),a=0;a<s.length;a++)s[a].length&&(a>0||!n)&&(s[a]=r+s[a]);return s.join(`
`)};m.prototype.renderPartial=function(t,o,n,r){if(n){var s=this.getConfigTags(r),a=ae(n)?n(t[1]):n[t[1]];if(a!=null){var i=t[6],c=t[5],l=t[4],d=a;c==0&&l&&(d=this.indentPartial(a,l,i));var g=this.parse(d,s);return this.renderTokens(g,o,n,d,r)}}};m.prototype.unescapedValue=function(t,o){var n=o.lookup(t[1]);if(n!=null)return n};m.prototype.escapedValue=function(t,o,n){var r=this.getConfigEscape(n)||y.escape,s=o.lookup(t[1]);if(s!=null)return typeof s=="number"&&r===y.escape?String(s):r(s)};m.prototype.rawValue=function(t){return t[1]};m.prototype.getConfigTags=function(t){return O(t)?t:t&&typeof t=="object"?t.tags:void 0};m.prototype.getConfigEscape=function(t){if(t&&typeof t=="object"&&!O(t))return t.escape};var y={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){N.templateCache=e},get templateCache(){return N.templateCache}},N=new m;y.clearCache=function(){return N.clearCache()};y.parse=function(t,o){return N.parse(t,o)};y.render=function(t,o,n,r){if(typeof t!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+ze(t)+'" was given as the first argument for mustache#render(template, view, partials)');return N.render(t,o,n,r)};y.escape=rt;y.Scanner=B;y.Context=T;y.Writer=m;class Be{constructor(t,o){this.template=t,this.state=o,this.ast=y.parse(t)}getValue(){return this.value===void 0&&(this.value=y.render(this.template,this.state)),this.value}onChange(t){const o=[];for(const n of this.getUsedVariables().values())o.push(this.state.onVariableChange(n).subscribe(()=>{const r=y.render(this.template,this.state);r!==this.value&&(this.value=r,t(this.value))}));return{unsubscribe:()=>{for(const n of o)n.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const t=new Set;return this.recursiveGetUsedVariables(this.ast,t),t}recursiveGetUsedVariables(t,o){for(const n of t){const r=n[0],s=n[1],a=n[4];["name","&","#","^"].includes(r)&&o.add(s),a!==void 0&&typeof a!="string"&&this.recursiveGetUsedVariables(a,o)}}}async function dt(){var e;const t=await ke();for(const o of t){const n=(e=o.properties)!==null&&e!==void 0?e:[];for(const r of n){if(r.type==="int"||r.type==="bool"||r.type==="object"||typeof r.value!="string")continue;const s=new Be(r.value,WA.state);if(s.isPureString())continue;const a=s.getValue();await he(o.name,r.name,a),s.onChange(async i=>{await he(o.name,r.name,i)})}}}async function ht(){var e;const t=await G();for(const[o,n]of t.entries())if(n.type!=="objectgroup"){const r=(e=n.properties)!==null&&e!==void 0?e:[];for(const s of r){if(s.type==="int"||s.type==="bool"||s.type==="object"||typeof s.value!="string")continue;const a=new Be(s.value,WA.state);if(a.isPureString())continue;const i=a.getValue();pe(o,s.name,i),a.onChange(c=>{pe(o,s.name,c)})}}}async function he(e,t,o){console.log(e),(await WA.room.area.get(e)).setProperty(t,o)}function pe(e,t,o){WA.room.setProperty(e,t,o),t==="visible"&&(o?WA.room.showLayer(e):WA.room.hideLayer(e))}const pt="https://admin.workadventu.re/html";let ne,ie=0,ce=0;function ge(e){if(WA.state[e.name]){let t=e.properties.mustGetString("openLayer");for(const o of t.split(`
`))WA.room.showLayer(o);t=e.properties.mustGetString("closeLayer");for(const o of t.split(`
`))WA.room.hideLayer(o)}else{let t=e.properties.mustGetString("openLayer");for(const o of t.split(`
`))WA.room.hideLayer(o);t=e.properties.mustGetString("closeLayer");for(const o of t.split(`
`))WA.room.showLayer(o)}}function gt(e){const t=e.properties.getString("openSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=He(e.properties.mustGetString("openLayer").split(`
`));if(r>o)return;n=1-r/o}t&&WA.sound.loadSound(t).play({volume:n})}function mt(e){const t=e.properties.getString("closeSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=He(e.properties.mustGetString("closeLayer").split(`
`));if(r>o)return;n=1-r/o}t&&WA.sound.loadSound(t).play({volume:n})}function xe(e){return e.map(t=>ne.get(t)).filter(t=>(t==null?void 0:t.type)==="tilelayer")}function He(e){const t=xe(e),o=Ge(t),n=((o.right-o.left)/2+o.left)*32,r=((o.bottom-o.top)/2+o.top)*32;return Math.sqrt(Math.pow(ie-n,2)+Math.pow(ce-r,2))}function yt(e){WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]?gt(e):mt(e),ge(e)}),ge(e)}function me(e,t,o,n){const r=e.name;let s,a,i=!1;const c=o.getString("tag");let l=!0;c&&!WA.player.tags.includes(c)&&(l=!1);const d=!!c;function g(){var f;s&&s.remove(),s=WA.ui.displayActionMessage({message:(f=o.getString("closeTriggerMessage"))!==null&&f!==void 0?f:"Press SPACE to close the door",callback:()=>{WA.state[t.name]=!1,u()}})}function u(){var f;s&&s.remove(),s=WA.ui.displayActionMessage({message:(f=o.getString("openTriggerMessage"))!==null&&f!==void 0?f:"Press SPACE to open the door",callback:()=>{WA.state[t.name]=!0,g()}})}function v(){let f;if(e.type==="tilelayer")f=Ge(xe(t.properties.mustGetString("closeLayer").split(`
`)));else{if(e.x===void 0||e.y===void 0||e.width===void 0||e.height===void 0)throw new Error(`Doorstep zone "${e.name}" is missing x, y, width or height`);f={top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}a=WA.room.website.create({name:"doorKeypad"+r,url:n+"/keypad.html#"+encodeURIComponent(r),position:{x:f.right*32,y:f.top*32,width:32*3,height:32*4},allowApi:!0})}function E(){a&&(WA.room.website.delete(a.name),a=void 0)}function p(){if(i=!0,o.getBoolean("autoOpen")&&l){WA.state[t.name]=!0;return}if(!WA.state[t.name]&&(d&&!l||!d)&&(o.getString("code")||o.getString("codeVariable"))){v();return}l&&(WA.state[t.name]?g():u())}function w(){i=!1,o.getBoolean("autoClose")&&(WA.state[t.name]=!1),s&&s.remove(),E()}e.type==="tilelayer"?(WA.room.onEnterLayer(r).subscribe(p),WA.room.onLeaveLayer(r).subscribe(w)):(WA.room.area.onEnter(r).subscribe(p),WA.room.area.onLeave(r).subscribe(w)),WA.state.onVariableChange(t.name).subscribe(()=>{i&&(!o.getBoolean("autoClose")&&WA.state[t.name]===!0&&g(),a&&WA.state[t.name]===!0&&E(),!o.getBoolean("autoOpen")&&WA.state[t.name]===!1&&u())})}function At(e){const t=e.properties.mustGetString("bellSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=Math.sqrt(Math.pow(e.x-ie,2)+Math.pow(e.y-ce,2));if(r>o)return;n=1-r/o}WA.sound.loadSound(t).play({volume:n})}function bt(e){WA.state[e.name]===void 0&&(WA.state[e.name]=0),WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]&&At(e)})}function ye(e,t,o){let n;const r=t.getString("bellPopup");if(o.type==="tilelayer"){const s=o.name;WA.room.onEnterLayer(s).subscribe(()=>{var a;r?n=WA.ui.openPopup(r,"",[{label:(a=t.getString("bellButtonText"))!==null&&a!==void 0?a:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.onLeaveLayer(s).subscribe(()=>{n&&(n.close(),n=void 0)})}else{const s=o.name;WA.room.area.onEnter(s).subscribe(()=>{var a;r?n=WA.ui.openPopup(r,"",[{label:(a=t.getString("bellButtonText"))!==null&&a!==void 0?a:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.area.onLeave(s).subscribe(()=>{n&&(n.close(),n=void 0)})}}async function vt(e){e=e??pt;const t=await $e();ne=await G();for(const o of t.values())o.properties.get("door")&&yt(o),o.properties.get("bell")&&bt(o);for(const o of ne.values()){const n=new _(o.properties),r=n.getString("doorVariable");if(r&&o.type==="tilelayer"){const a=t.get(r);if(a===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of layer "'+o.name+'"');me(o,a,n,e)}const s=n.getString("bellVariable");s&&o.type==="tilelayer"&&ye(s,n,o)}for(const o of await ke()){const n=new _(o.properties),r=n.getString("doorVariable");if(r){const a=t.get(r);if(a===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of object "'+o.name+'"');me(o,a,n,e)}const s=n.getString("bellVariable");s&&ye(s,n,o)}WA.player.onPlayerMove(o=>{ie=o.x,ce=o.y})}function wt(e,t){const o=e.getString("bindVariable");if(o){const n=e.get("enterValue"),r=e.get("leaveValue"),s=e.getString("triggerMessage"),a=e.getString("tag");Wt(o,t,n,r,s,a)}}function Wt(e,t,o,n,r,s){s&&!WA.player.tags.includes(s)||(o!==void 0&&WA.room.onEnterLayer(t).subscribe(()=>{r||(WA.state[e]=o)}),n!==void 0&&WA.room.onLeaveLayer(t).subscribe(()=>{WA.state[e]=n}))}async function Et(){const e=await G();for(const t of e.values()){const o=new _(t.properties);wt(o,t.name)}}let Ae;async function Rt(e){const t=await WA.room.getTiledMap();e=e??Me,Ae=await G();const o=t.layers.find(n=>n.name==="configuration");if(o){const r=new _(o.properties).getString("tag");(!r||WA.player.tags.includes(r))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(e+"/configuration.html",!0)});for(const s of Ae.values()){const a=new _(s.properties),i=a.getString("openConfig");i&&s.type==="tilelayer"&&Ct(i.split(","),s.name,a)}}}function Ct(e,t,o){let n;const r=o.getString("openConfigAdminTag");let s=!0;r&&!WA.player.tags.includes(r)&&(s=!1);function a(){var c;n&&n.remove(),n=WA.ui.displayActionMessage({message:(c=o.getString("openConfigTriggerMessage"))!==null&&c!==void 0?c:"Press SPACE or touch here to configure",callback:()=>ue(e)})}function i(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(t).subscribe(()=>{const c=o.getString("openConfigTrigger");s&&(c&&c==="onaction"?a():ue(e))}),WA.room.onLeaveLayer(t).subscribe(()=>{n&&n.remove(),i()})}function St(){return WA.onInit().then(()=>{vt().catch(e=>console.error(e)),Et().catch(e=>console.error(e)),Rt().catch(e=>console.error(e)),ht().catch(e=>console.error(e)),dt().catch(e=>console.error(e))}).catch(e=>console.error(e))}console.info("Roofs Script started successfully");let W=!0;WA.onInit().then(()=>{WA.room.area.onEnter("hallZone").subscribe(()=>{WA.room.hideLayer("roofHall")}),WA.room.area.onLeave("hallZone").subscribe(()=>{WA.room.showLayer("roofHall")}),WA.room.area.onEnter("roomsZone").subscribe(()=>{WA.room.hideLayer("roofRooms"),WA.room.hideLayer("logo-LearningCenter"),W=!1,console.log(W)}),WA.room.area.onLeave("roomsZone").subscribe(()=>{WA.room.showLayer("roofRooms"),WA.room.showLayer("logo-LearningCenter"),W=!0,console.log(W)}),WA.room.area.onEnter("1").subscribe(()=>{WA.room.hideLayer("above/aboveRoom1-Front"),WA.room.showLayer("focus/R1"),W&&(WA.room.hideLayer("roofRooms"),WA.room.hideLayer("logo-LearningCenter"),console.log("openby1"))}),WA.room.area.onLeave("1").subscribe(()=>{WA.room.showLayer("above/aboveRoom1-Front"),WA.room.hideLayer("focus/R1")}),WA.room.area.onEnter("2").subscribe(()=>{WA.room.hideLayer("above/aboveRoom2-Front"),WA.room.showLayer("focus/R2"),W&&(WA.room.hideLayer("roofRooms"),WA.room.hideLayer("logo-LearningCenter"))}),WA.room.area.onLeave("2").subscribe(()=>{WA.room.showLayer("above/aboveRoom2-Front"),WA.room.hideLayer("focus/R2")}),WA.room.area.onEnter("3").subscribe(()=>{WA.room.hideLayer("above/aboveRoom3-Front"),WA.room.showLayer("focus/R3"),W&&(WA.room.hideLayer("roofRooms"),WA.room.hideLayer("logo-LearningCenter"))}),WA.room.area.onLeave("3").subscribe(()=>{WA.room.showLayer("above/aboveRoom3-Front"),WA.room.hideLayer("focus/R3")}),WA.room.area.onEnter("4").subscribe(()=>{WA.room.hideLayer("above/aboveRoom4-Front"),WA.room.showLayer("focus/R4"),W&&(WA.room.hideLayer("roofRooms"),WA.room.hideLayer("logo-LearningCenter"))}),WA.room.area.onLeave("4").subscribe(()=>{WA.room.showLayer("above/aboveRoom4-Front"),WA.room.hideLayer("focus/R4")}),WA.room.area.onEnter("5").subscribe(()=>{WA.room.hideLayer("above/aboveRoom5-Front"),WA.room.showLayer("focus/R5"),W&&(WA.room.hideLayer("roofRooms"),WA.room.hideLayer("logo-LearningCenter"))}),WA.room.area.onLeave("5").subscribe(()=>{WA.room.showLayer("above/aboveRoom5-Front"),WA.room.hideLayer("focus/R5")}),WA.room.area.onEnter("6").subscribe(()=>{WA.room.hideLayer("above/aboveRoom6-Front"),WA.room.showLayer("focus/R6"),W&&(WA.room.hideLayer("roofRooms"),WA.room.hideLayer("logo-LearningCenter"))}),WA.room.area.onLeave("6").subscribe(()=>{WA.room.showLayer("above/aboveRoom6-Front"),WA.room.hideLayer("focus/R6")})}).catch(e=>console.error(e));console.info("Actions Script started successfully");let U,h,be=0,F=!1,re=255,ve=!0,J=!1,X=!1,z=!1,Q=!1,Z=!1;WA.onInit().then(()=>{WA.room.area.onEnter("P1").subscribe(()=>{h=WA.ui.displayActionMessage({message:`Press 'Spacebar' OR 'Click' 
to 'Hall' room `,callback:()=>{WA.nav.goToRoom("#H1"),console.log("Portal1 to Hall1")}})}),WA.room.area.onEnter("P2").subscribe(()=>{h=WA.ui.displayActionMessage({message:`Press 'Spacebar' OR 'Click' 
to 'CPW Hall of Fame' room `,callback:()=>{WA.nav.goToRoom("#R2"),console.log("Portal2 to Room2")}})}),WA.room.area.onEnter("P3").subscribe(()=>{h=WA.ui.displayActionMessage({message:`Press 'Spacebar' OR 'Click' 
to 'CPW Pitching 2022' room `,callback:()=>{WA.nav.goToRoom("#R3"),console.log("Portal3 to Room3")}})}),WA.room.area.onEnter("P4").subscribe(()=>{h=WA.ui.displayActionMessage({message:`Press 'Spacebar' OR 'Click' 
to 'A-Gadgets' room `,callback:()=>{WA.nav.goToRoom("#R4"),console.log("Portal4 to Room4")}})}),WA.room.area.onEnter("P5").subscribe(()=>{h=WA.ui.displayActionMessage({message:`Press 'Spacebar' OR 'Click' 
to 'B-Competitive Game' room `,callback:()=>{WA.nav.goToRoom("#R5"),console.log("Portal5 to Room5")}})}),WA.room.area.onEnter("P6").subscribe(()=>{h=WA.ui.displayActionMessage({message:`Press 'Spacebar' OR 'Click' 
to 'C-Self Entertain' room `,callback:()=>{WA.nav.goToRoom("#R6"),console.log("Portal6 to Room")}})}),WA.room.area.onLeave("P1").subscribe(()=>{h!==void 0&&h.remove()}),WA.room.area.onLeave("P2").subscribe(()=>{h!==void 0&&h.remove()}),WA.room.area.onLeave("P3").subscribe(()=>{h!==void 0&&h.remove()}),WA.room.area.onLeave("P4").subscribe(()=>{h!==void 0&&h.remove()}),WA.room.area.onLeave("P5").subscribe(()=>{h!==void 0&&h.remove()}),WA.room.area.onLeave("P6").subscribe(()=>{h!==void 0&&h.remove()}),WA.room.area.onEnter("RoomL").subscribe(()=>{h=WA.ui.displayActionMessage({message:`Press 'Spacebar' OR 'Click' 
to Right side`,callback:()=>{WA.nav.goToRoom("#RoomR"),console.log("Left to Right side")}})}),WA.room.area.onEnter("RoomR").subscribe(()=>{h=WA.ui.displayActionMessage({message:`Press 'Spacebar' OR 'Click' 
to Left side`,callback:()=>{WA.nav.goToRoom("#RoomL"),console.log("Right to Left side")}})}),WA.room.area.onLeave("RoomL").subscribe(()=>{h!==void 0&&h.remove()}),WA.room.area.onLeave("RoomR").subscribe(()=>{h!==void 0&&h.remove()}),WA.room.onEnterLayer("start").subscribe(()=>{be++,console.log(be)}),WA.room.area.onEnter("title_zone").subscribe(()=>{F||(WA.state.countPlayers++,F=!0),console.log(WA.state.countPlayers)}),WA.room.area.onEnter("checkCountPlayers").subscribe(()=>{F||(WA.state.countPlayers++,F=!0),console.log("alertVar is "+WA.state.alertVar),console.log("alert is "+re),console.log(WA.state.countPlayers)}),WA.room.onEnterLayer("walk/1").subscribe(()=>{ve&&(WA.room.hideLayer("walk/1"),WA.room.showLayer("walk/2"),ve=!1,J=!0)}),WA.room.onEnterLayer("walk/2").subscribe(()=>{J&&(WA.room.hideLayer("walk/2"),WA.room.showLayer("walk/3"),J=!1,X=!0)}),WA.room.onEnterLayer("walk/3").subscribe(()=>{X&&(WA.room.hideLayer("walk/3"),WA.room.showLayer("walk/4"),X=!1,z=!0)}),WA.room.onEnterLayer("walk/4").subscribe(()=>{z&&(WA.room.hideLayer("walk/4"),WA.room.showLayer("walk/5"),z=!1,Q=!0)}),WA.room.onEnterLayer("walk/5").subscribe(()=>{Q&&(WA.room.hideLayer("walk/5"),WA.room.showLayer("walk/6"),Q=!1,Z=!0)}),WA.room.onEnterLayer("walk/6").subscribe(()=>{Z&&(WA.room.hideLayer("walk/6"),Z=!1)}),WA.room.area.onLeave("alerttest").subscribe(()=>{re=WA.state.alertVar,WA.room.hideLayer("alert")}),WA.room.area.onEnter("alerttest").subscribe(()=>{WA.state.alertVar++}),De(),WA.room.area.onEnter("title_zone").subscribe(()=>{const e=new Date,t=e.getHours()+":"+e.getMinutes();console.log("titlezone"),U=WA.ui.openPopup("title_pop",`Welcome to Learning Center!! 
 at `+t+" NOW HAVING "+WA.state.countPlayers+" Players",[])}),WA.room.area.onLeave("title_zone").subscribe(Lt)}).catch(e=>console.error(e));const De=()=>{WA.state.alertVar!==re?WA.room.showLayer("alert"):WA.room.hideLayer("alert"),setTimeout(De,1500)};function Lt(){U!==void 0&&(U.close(),U=void 0)}console.log("Funnel script loaded");const _t=()=>{WA.ui.modal.openModal({title:"Review",src:"https://padlet.com/embed/tk2fbn34hg15d58j/slideshow?autoplay=1&loop=1",allow:"fullscreen; clipboard-read; clipboard-write",allowApi:!0,position:"center"})},Tt=()=>{WA.ui.modal.openModal({title:"Review",src:"https://padlet.com/aonparrot/submission-request/1OL2bZnNAM9lbaK3",allow:"fullscreen; clipboard-read; clipboard-write",allowApi:!0,position:"center"})};WA.onInit().then(()=>{WA.room.area.onEnter("gameHall_zone").subscribe(()=>{WA.ui.modal.closeModal(),_t()}),WA.room.area.onLeave("gameHall_zone").subscribe(()=>{WA.ui.modal.closeModal()}),WA.room.area.onEnter("alerttest").subscribe(()=>{WA.ui.modal.closeModal(),Tt()}),WA.room.area.onLeave("alerttest").subscribe(()=>{WA.ui.modal.closeModal()})});console.info("Bot Script started successfully");WA.room.area.onEnter("bot_spawn").subscribe(()=>{WA.nav.goToRoom("#"),setTimeout(()=>{WA.onInit().then(()=>{console.log("Get Script"),Fe()})},1e3)});let M=4600,I=1900;function Fe(){console.log("Start Walking");const e=Math.floor(Math.random()*700)-350,t=Math.floor(Math.random()*700)-350;M+=e,I+=t,I>2440&&(I=2420),M>4840&&(M=4780),WA.player.moveTo(M,I,10),setTimeout(function(){WA.onInit().then(async()=>{console.log("St Position : ",await WA.player.getPosition())}),console.log("to Position X: ",M),console.log("to Position Y: ",I),Fe()},Math.floor(Math.random()*4e3)+6e3)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const we=["user","model","function"];var We;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(We||(We={}));var Ee;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(Ee||(Ee={}));var Re;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(Re||(Re={}));var Ce;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(Ce||(Ce={}));var V;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.OTHER="OTHER"})(V||(V={}));var Se;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(Se||(Se={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Le;(function(e){e.STRING="STRING",e.NUMBER="NUMBER",e.INTEGER="INTEGER",e.BOOLEAN="BOOLEAN",e.ARRAY="ARRAY",e.OBJECT="OBJECT"})(Le||(Le={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A extends Error{constructor(t){super(`[GoogleGenerativeAI Error]: ${t}`)}}class j extends A{constructor(t,o){super(t),this.response=o}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ot="https://generativelanguage.googleapis.com",Pt="v1",Mt="0.3.1",It="genai-js";var S;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(S||(S={}));class x{constructor(t,o,n,r,s){this.model=t,this.task=o,this.apiKey=n,this.stream=r,this.requestOptions=s}toString(){var t;const o=((t=this.requestOptions)===null||t===void 0?void 0:t.apiVersion)||Pt;let n=`${Ot}/${o}/${this.model}:${this.task}`;return this.stream&&(n+="?alt=sse"),n}}function Nt(){return`${It}/${Mt}`}async function H(e,t,o){let n;try{if(n=await fetch(e.toString(),Object.assign(Object.assign({},kt(o)),{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-client":Nt(),"x-goog-api-key":e.apiKey},body:t})),!n.ok){let r="";try{const s=await n.json();r=s.error.message,s.error.details&&(r+=` ${JSON.stringify(s.error.details)}`)}catch{}throw new Error(`[${n.status} ${n.statusText}] ${r}`)}}catch(r){const s=new A(`Error fetching from ${e.toString()}: ${r.message}`);throw s.stack=r.stack,s}return n}function kt(e){const t={};if((e==null?void 0:e.timeout)>=0){const o=new AbortController,n=o.signal;setTimeout(()=>o.abort(),e.timeout),t.signal=n}return t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function le(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),se(e.candidates[0]))throw new j(`${L(e)}`,e);return Gt(e)}else if(e.promptFeedback)throw new j(`Text not available. ${L(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function call from the first candidate only. Access response.candidates directly to use the other candidates.`),se(e.candidates[0]))throw new j(`${L(e)}`,e);return Bt(e)}else if(e.promptFeedback)throw new j(`Function call not available. ${L(e)}`,e)},e}function Gt(e){var t,o,n,r;return!((r=(n=(o=(t=e.candidates)===null||t===void 0?void 0:t[0].content)===null||o===void 0?void 0:o.parts)===null||n===void 0?void 0:n[0])===null||r===void 0)&&r.text?e.candidates[0].content.parts.map(({text:s})=>s).join(""):""}function Bt(e){var t,o,n,r;return(r=(n=(o=(t=e.candidates)===null||t===void 0?void 0:t[0].content)===null||o===void 0?void 0:o.parts)===null||n===void 0?void 0:n[0])===null||r===void 0?void 0:r.functionCall}const xt=[V.RECITATION,V.SAFETY];function se(e){return!!e.finishReason&&xt.includes(e.finishReason)}function L(e){var t,o,n;let r="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)r+="Response was blocked",!((t=e.promptFeedback)===null||t===void 0)&&t.blockReason&&(r+=` due to ${e.promptFeedback.blockReason}`),!((o=e.promptFeedback)===null||o===void 0)&&o.blockReasonMessage&&(r+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((n=e.candidates)===null||n===void 0)&&n[0]){const s=e.candidates[0];se(s)&&(r+=`Candidate was blocked due to ${s.finishReason}`,s.finishMessage&&(r+=`: ${s.finishMessage}`))}return r}function k(e){return this instanceof k?(this.v=e,this):new k(e)}function Ht(e,t,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=o.apply(e,t||[]),r,s=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(u){n[u]&&(r[u]=function(v){return new Promise(function(E,p){s.push([u,v,E,p])>1||i(u,v)})})}function i(u,v){try{c(n[u](v))}catch(E){g(s[0][3],E)}}function c(u){u.value instanceof k?Promise.resolve(u.value.v).then(l,d):g(s[0][2],u)}function l(u){i("next",u)}function d(u){i("throw",u)}function g(u,v){u(v),s.shift(),s.length&&i(s[0][0],s[0][1])}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _e=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Dt(e){const t=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),o=Ut(t),[n,r]=o.tee();return{stream:jt(n),response:Ft(r)}}async function Ft(e){const t=[],o=e.getReader();for(;;){const{done:n,value:r}=await o.read();if(n)return le(Vt(t));t.push(r)}}function jt(e){return Ht(this,arguments,function*(){const o=e.getReader();for(;;){const{value:n,done:r}=yield k(o.read());if(r)break;yield yield k(le(n))}})}function Ut(e){const t=e.getReader();return new ReadableStream({start(n){let r="";return s();function s(){return t.read().then(({value:a,done:i})=>{if(i){if(r.trim()){n.error(new A("Failed to parse stream"));return}n.close();return}r+=a;let c=r.match(_e),l;for(;c;){try{l=JSON.parse(c[1])}catch{n.error(new A(`Error parsing JSON response: "${c[1]}"`));return}n.enqueue(l),r=r.substring(c[0].length),c=r.match(_e)}return s()})}}})}function Vt(e){const t=e[e.length-1],o={promptFeedback:t==null?void 0:t.promptFeedback};for(const n of e)if(n.candidates)for(const r of n.candidates){const s=r.index;if(o.candidates||(o.candidates=[]),o.candidates[s]||(o.candidates[s]={index:r.index}),o.candidates[s].citationMetadata=r.citationMetadata,o.candidates[s].finishReason=r.finishReason,o.candidates[s].finishMessage=r.finishMessage,o.candidates[s].safetyRatings=r.safetyRatings,r.content&&r.content.parts){o.candidates[s].content||(o.candidates[s].content={role:r.content.role||"user",parts:[]});const a={};for(const i of r.content.parts)i.text&&(a.text=i.text),i.functionCall&&(a.functionCall=i.functionCall),Object.keys(a).length===0&&(a.text=""),o.candidates[s].content.parts.push(a)}}return o}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function je(e,t,o,n){const r=new x(t,S.STREAM_GENERATE_CONTENT,e,!0,n),s=await H(r,JSON.stringify(o),n);return Dt(s)}async function Ue(e,t,o,n){const r=new x(t,S.GENERATE_CONTENT,e,!1,n),a=await(await H(r,JSON.stringify(o),n)).json();return{response:le(a)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K(e){let t=[];if(typeof e=="string")t=[{text:e}];else for(const o of e)typeof o=="string"?t.push({text:o}):t.push(o);return Kt(t)}function Kt(e){const t={role:"user",parts:[]},o={role:"function",parts:[]};let n=!1,r=!1;for(const s of e)"functionResponse"in s?(o.parts.push(s),r=!0):(t.parts.push(s),n=!0);if(n&&r)throw new A("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!n&&!r)throw new A("No content is provided for sending chat message.");return n?t:o}function ee(e){return e.contents?e:{contents:[K(e)]}}function $t(e){return typeof e=="string"||Array.isArray(e)?{content:K(e)}:e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Te=["text","inlineData","functionCall","functionResponse"],Yt={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall"]},Oe={user:["model"],function:["model"],model:["user","function"]};function qt(e){let t;for(const o of e){const{role:n,parts:r}=o;if(!t&&n!=="user")throw new A(`First content should be with role 'user', got ${n}`);if(!we.includes(n))throw new A(`Each item should include role field. Got ${n} but valid roles are: ${JSON.stringify(we)}`);if(!Array.isArray(r))throw new A("Content should have 'parts' property with an array of Parts");if(r.length===0)throw new A("Each Content should have at least one part");const s={text:0,inlineData:0,functionCall:0,functionResponse:0};for(const i of r)for(const c of Te)c in i&&(s[c]+=1);const a=Yt[n];for(const i of Te)if(!a.includes(i)&&s[i]>0)throw new A(`Content with role '${n}' can't contain '${i}' part`);if(t&&!Oe[n].includes(t.role))throw new A(`Content with role '${n}' can't follow '${t.role}'. Valid previous roles: ${JSON.stringify(Oe)}`);t=o}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pe="SILENT_ERROR";class Jt{constructor(t,o,n,r){this.model=o,this.params=n,this.requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=t,n!=null&&n.history&&(qt(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(t){var o,n,r;await this._sendPromise;const s=K(t),a={safetySettings:(o=this.params)===null||o===void 0?void 0:o.safetySettings,generationConfig:(n=this.params)===null||n===void 0?void 0:n.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,contents:[...this._history,s]};let i;return this._sendPromise=this._sendPromise.then(()=>Ue(this._apiKey,this.model,a,this.requestOptions)).then(c=>{var l;if(c.response.candidates&&c.response.candidates.length>0){this._history.push(s);const d=Object.assign({parts:[],role:"model"},(l=c.response.candidates)===null||l===void 0?void 0:l[0].content);this._history.push(d)}else{const d=L(c.response);d&&console.warn(`sendMessage() was unsuccessful. ${d}. Inspect response object for details.`)}i=c}),await this._sendPromise,i}async sendMessageStream(t){var o,n,r;await this._sendPromise;const s=K(t),a={safetySettings:(o=this.params)===null||o===void 0?void 0:o.safetySettings,generationConfig:(n=this.params)===null||n===void 0?void 0:n.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,contents:[...this._history,s]},i=je(this._apiKey,this.model,a,this.requestOptions);return this._sendPromise=this._sendPromise.then(()=>i).catch(c=>{throw new Error(Pe)}).then(c=>c.response).then(c=>{if(c.candidates&&c.candidates.length>0){this._history.push(s);const l=Object.assign({},c.candidates[0].content);l.role||(l.role="model"),this._history.push(l)}else{const l=L(c);l&&console.warn(`sendMessageStream() was unsuccessful. ${l}. Inspect response object for details.`)}}).catch(c=>{c.message!==Pe&&console.error(c)}),i}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xt(e,t,o,n){const r=new x(t,S.COUNT_TOKENS,e,!1,{});return(await H(r,JSON.stringify(Object.assign(Object.assign({},o),{model:t})),n)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zt(e,t,o,n){const r=new x(t,S.EMBED_CONTENT,e,!1,{});return(await H(r,JSON.stringify(o),n)).json()}async function Qt(e,t,o,n){const r=new x(t,S.BATCH_EMBED_CONTENTS,e,!1,{}),s=o.requests.map(i=>Object.assign(Object.assign({},i),{model:t}));return(await H(r,JSON.stringify({requests:s}),n)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zt{constructor(t,o,n){this.apiKey=t,o.model.includes("/")?this.model=o.model:this.model=`models/${o.model}`,this.generationConfig=o.generationConfig||{},this.safetySettings=o.safetySettings||[],this.tools=o.tools,this.requestOptions=n||{}}async generateContent(t){const o=ee(t);return Ue(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools},o),this.requestOptions)}async generateContentStream(t){const o=ee(t);return je(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools},o),this.requestOptions)}startChat(t){return new Jt(this.apiKey,this.model,Object.assign({tools:this.tools},t),this.requestOptions)}async countTokens(t){const o=ee(t);return Xt(this.apiKey,this.model,o)}async embedContent(t){const o=$t(t);return zt(this.apiKey,this.model,o)}async batchEmbedContents(t){return Qt(this.apiKey,this.model,t,this.requestOptions)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo{constructor(t){this.apiKey=t}getGenerativeModel(t,o){if(!t.model)throw new A("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Zt(this.apiKey,t,o)}}const to=new eo("AIzaSyCjSWKop9h4C9iZHHaTVwhRA340Awbj0gY");async function oo(e){return(await(await to.getGenerativeModel({model:"gemini-pro"}).generateContent(e+" ให้เข้าใจง่าย")).response).text()}console.info("Chat Script started successfully");WA.onInit().then(()=>{WA.room.area.onEnter("chatZone").subscribe(()=>{WA.chat.sendChatMessage("สวัสดีครับมีอะไรให้ช่วย ไหมครับ?","เอไอ"),WA.chat.open(),WA.chat.onChatMessage(e=>{oo(e).then(t=>{WA.chat.sendChatMessage(t,"เอไอ")})})}),WA.room.area.onLeave("chatZone").subscribe(()=>{WA.chat.close()})}).catch(e=>console.error(e));console.log("Script started successfully");let te=!1,oe=!1;WA.onInit().then(async()=>{console.log("Scripting API ready"),await WA.players.configureTracking();const e=WA.players.list();console.log(e);for(const n of e)console.log(`Player ${n.name} is near you`);console.log("Token: ",WA.player.userRoomToken),console.log("Player name: ",WA.player.name),console.log("Player tags: ",WA.player.tags),console.log("Player ID: ",WA.player.id),WA.ui.actionBar.addButton({id:"btn-poll-a",type:"action",imageSrc:"https://i.ibb.co/8452NqN/rocket-lunchx.png",toolTip:"MINI MAP",callback:()=>{if(te){WA.ui.modal.closeModal(),te=!1;return}t(),te=!0}});const t=async()=>{WA.ui.modal.closeModal(),WA.ui.modal.openModal({src:"https://i.ibb.co/QXhXY8R/Screenshot-2567-03-01-at-09-37-21.png",allow:"",title:"website",allowApi:!0,position:"center"})};WA.ui.actionBar.addButton({id:"btn-form",type:"action",imageSrc:"https://i.ibb.co/JFXcrqH/computerx.png",toolTip:"Questionnaire",callback:()=>{if(oe){WA.ui.modal.closeModal(),oe=!1;return}o(),oe=!0}});const o=async()=>{WA.ui.modal.closeModal(),WA.ui.modal.openModal({src:"https://docs.google.com/forms/d/e/1FAIpQLSfsBAyWHjq2h6Mo7YZJKPZQV025nn6saqe4BCsgE20aucU07w/viewform?embedded=true",allow:"fullscreen",title:"website",allowApi:!0,position:"center"})};St().then(()=>{console.log("Scripting API Extra ready")}).catch(n=>console.error(n))}).catch(e=>console.error(e));
